"use strict";(()=>{(function(){"use strict";let y=["*"],u="NEO_HEATMAP",p="neo-heatmap-overlay-root",m="data-neo-heatmap-overlay",r={items:[],maxCount:1,currentStep:-1,overlayRoot:null,spotEls:[],observer:null,rafId:0,moTimer:0,isRendering:!1},c=[];function L(t){return y.indexOf("*")!==-1?!0:y.indexOf(t)!==-1}function g(t){let e=Number(t);return Number.isFinite(e)?Math.max(0,Math.min(1,e)):.5}function f(t,e,n){return t+(e-t)*n}function H(t){let e=0;for(let n=0;n<t.length;n++){let o=t.charCodeAt(n);e=(e<<5)-e+o,e=e&e}return Math.abs(e).toString(16).substring(0,8)}let d=[{stop:0,color:{r:0,g:0,b:255}},{stop:.3,color:{r:0,g:255,b:255}},{stop:.5,color:{r:0,g:255,b:0}},{stop:.7,color:{r:255,g:255,b:0}},{stop:1,color:{r:255,g:0,b:0}}],A=20,v=40,_=150;function k(t){let e=Math.max(0,Math.min(1,t)),n=0;for(;n<d.length-1&&e>d[n+1].stop;)n++;let o=d[n],i=d[Math.min(n+1,d.length-1)],s=i.stop-o.stop||1,l=(e-o.stop)/s;return{r:Math.round(f(o.color.r,i.color.r,l)),g:Math.round(f(o.color.g,i.color.g,l)),b:Math.round(f(o.color.b,i.color.b,l))}}function E(t,e){return`rgba(${t.r}, ${t.g}, ${t.b}, ${e})`}function P(t,e){let n=Math.max(A,e||0),o=n>0?Math.max(0,Math.min(1,t/n)):0,i=k(o),s=v+Math.sqrt(o)*(_-v),l=.35+.65*o,a=.18+.42*o;return{width:s+"px",height:s+"px",background:`radial-gradient(circle, ${E(i,l)} 0%, ${E(i,a)} 55%, ${E(i,0)} 100%)`,opacity:1}}function x(t){if(t.xpathWithHash){let e=t.xpathWithHash.lastIndexOf("#");return e>0?t.xpathWithHash.substring(0,e):t.xpathWithHash}return t.xpath||""}function O(t,e){if(!t||!e)return null;try{let n=e.match(/@id="([^"]+)"/);if(n&&n[1]){let s=t.getElementById(n[1]);if(s)return s}let o=t.evaluate(e,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),i=o.singleNodeValue;if(i&&i.nodeType===1)return i;if(e.indexOf("/body")===0||e.indexOf("//body")===0){let s=e.replace(/^\/+body/,"/html/body");if(o=t.evaluate(s,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),i=o.singleNodeValue,i&&i.nodeType===1)return i}return null}catch(n){return null}}function N(t){if(!t)return!1;try{let e=t;for(;e&&e!==document.body&&e!==document.documentElement;){let o=window.getComputedStyle(e);if(o.display==="none"||o.visibility==="hidden"||o.opacity==="0")return!1;e=e.parentElement}let n=t.getBoundingClientRect();return n.width>0&&n.height>0}catch(e){return!1}}function $(t){var s,l,a;let e=(s=t.closest)==null?void 0:s.call(t,".question-select-list > li");if(e)return e;let o=(a=(l=t.closest)==null?void 0:l.call(t,'[data-neo-track],a,button,input,textarea,select,label,[role="button"]'))!=null?a:t,i=o.getBoundingClientRect();for(;(i.width<=0||i.height<=0)&&o.parentElement;)o=o.parentElement,i=o.getBoundingClientRect();return o}function T(t){if(t.id)return`//*[@id="${t.id}"]`;let e=[],n=t;for(;n&&n.nodeType===Node.ELEMENT_NODE&&n!==document.body;){let o=1,i=n.previousElementSibling;for(;i;)i.tagName===n.tagName&&o++,i=i.previousElementSibling;let s=n.tagName.toLowerCase();e.unshift(`${s}[${o}]`),n=n.parentElement}return"//body/"+e.join("/")}function D(t){let e=T(t),n=[t.tagName,t.id||"",t.className||"",(t.textContent||"").trim().substring(0,30)].join("|");return`${e}#${H(n)}`}function W(t){return t instanceof HTMLInputElement?t.value||t.placeholder||"":(t.textContent||"").trim().substring(0,100)}function B(t){var a;let e=t.target;if(!e||!(e instanceof Element)||(a=e.closest)!=null&&a.call(e,`[${m}]`))return;let n=$(e),o=n.getBoundingClientRect(),i=o.width>0?(t.clientX-o.left)/o.width:.5,s=o.height>0?(t.clientY-o.top)/o.height:.5,l={xpath:T(n),xpathWithHash:D(n),tagName:n.tagName.toLowerCase(),text:W(n),xRatio:g(i),yRatio:g(s)};c.push(l),console.log("[NEO] Click #"+c.length+":",l)}function X(){let t=document.getElementById(p);return t||(t=document.createElement("div"),t.id=p,t.setAttribute(m,"1"),t.style.cssText=["position: fixed","left: 0","top: 0","width: 100vw","height: 100vh","pointer-events: none","z-index: 2147483647","mix-blend-mode: multiply","overflow: visible"].join(";"),(document.body||document.documentElement).appendChild(t),t)}function R(){let t=document.getElementById(p);t&&t.remove(),r.overlayRoot=null,r.spotEls=[]}function M(){for(let t=0;t<r.spotEls.length;t++){let e=r.spotEls[t];if(!e)continue;let n=!1;r.currentStep===-1?n=!0:r.currentStep===-2?n=!1:n=t<=r.currentStep,e.style.opacity=n?"1":"0"}}function b(){if(!(!document.body&&!document.documentElement)){r.isRendering=!0;try{r.overlayRoot=X(),r.overlayRoot.innerHTML="",r.spotEls=new Array(r.items.length);for(let t=0;t<r.items.length;t++){let e=r.items[t],n=x(e),o=O(document,n);if(!o||!N(o)){r.spotEls[t]=null;continue}let i=P(e.count||1,r.maxCount),s=document.createElement("div");s.className="neo-heatmap-spot",s.setAttribute(m,"1"),s.style.cssText=["position: fixed","pointer-events: none","left: 0px","top: 0px","transform: translate(-50%, -50%)",`width: ${i.width}`,`height: ${i.height}`,`background: ${i.background}`,"opacity: 1","border-radius: 50%","filter: blur(10px)","transition: opacity 0.3s ease"].join(";"),r.overlayRoot.appendChild(s),r.spotEls[t]=s}I(),M()}finally{r.isRendering=!1}}}function I(){for(let t=0;t<r.items.length;t++){let e=r.spotEls[t];if(!e)continue;let n=r.items[t],o=x(n),i=O(document,o);if(!i||!N(i)){e.style.opacity="0";continue}let s=i.getBoundingClientRect(),l=g(n.xRatio),a=g(n.yRatio),j=s.left+s.width*l,q=s.top+s.height*a;e.style.left=j+"px",e.style.top=q+"px"}}function S(){r.rafId||(r.rafId=requestAnimationFrame(()=>{r.rafId=0,I()}))}function F(t){return!t||t.nodeType!==1?!1:!!(t.closest&&t.closest(`[${m}]`))}function C(){window.addEventListener("scroll",S,{passive:!0}),window.addEventListener("resize",S),r.observer&&r.observer.disconnect(),document.body&&(r.observer=new MutationObserver(t=>{if(!r.isRendering){for(let e of t)if(F(e.target))return;clearTimeout(r.moTimer),r.moTimer=window.setTimeout(()=>{b()},120)}}),r.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class","hidden","disabled"]}))}function h(t,e,n){try{t.postMessage(n,e)}catch(o){t.postMessage(n,"*")}}function V(t){if(!t||!t.data||t.data.ns!==u||!L(t.origin))return;let e=t.data.type,n=t.data.requestId,o=t.data.payload||{},i=t.source;if(e==="PING"){h(i,t.origin,{ns:u,type:"PONG",requestId:n});return}if(e==="INIT"){r.items=o.items||[],r.maxCount=o.maxCount||1,r.currentStep=typeof o.currentStep=="number"?o.currentStep:-1;let s=()=>{C(),b(),h(i,t.origin,{ns:u,type:"INIT_OK",requestId:n})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s,{once:!0}):s();return}if(e==="SET_STEP"){r.currentStep=o.currentStep,M(),h(i,t.origin,{ns:u,type:"SET_STEP_OK",requestId:n});return}if(e==="CLEAR"){R(),h(i,t.origin,{ns:u,type:"CLEAR_OK",requestId:n});return}}window.NEO={get:function(){let t={success:!0,count:c.length,data:c};return console.log("[NEO] Copy this data:"),console.log(JSON.stringify(t,null,2)),t},clear:function(){c.length=0,console.log("[NEO] Cleared all clicks")},count:function(){return console.log("[NEO] Total clicks:",c.length),c.length},render:function(t,e=1){r.items=t,r.maxCount=e,r.currentStep=-1,C(),b(),console.log("[NEO] Rendered",t.length,"spots")},clearOverlay:function(){R(),console.log("[NEO] Overlay cleared")}};function w(){window.addEventListener("message",V),window.self===window.top?(document.addEventListener("click",B,!0),console.log("[NEO Agent+Tracker] Initialized (standalone mode)"),console.log("[NEO] Commands: NEO.get() | NEO.clear() | NEO.count() | NEO.render(items)")):console.log("[NEO Agent] Initialized (iframe mode - waiting for INIT message)")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w()})();})();
